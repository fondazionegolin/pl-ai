{% extends 'base.html' %}

{% block content %}
<div class="login-container">
    <div class="login-card">
        <div class="login-image"></div>
        <div class="login-form">
            <div class="login-logo">
                <img src="{{ url_for('static', filename='images/login/logo.png') }}" alt="Logo">
            </div>
            <h1 class="login-title">Benvenuto in PL-AI</h1>
            <p class="login-subtitle">Inserisci le tue credenziali per accedere</p>

            {% if error %}
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                <span class="block sm:inline">{{ error }}</span>
            </div>
            {% endif %}

            {% if success %}
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                <span class="block sm:inline">{{ success }}</span>
            </div>
            {% endif %}
            
            <div id="message-container"></div>

            <form method="POST" action="{{ url_for('login') }}">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" name="username" id="username" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" name="password" id="password" required class="form-input">
                </div>
                <button type="submit" class="login-button">
                    Accedi
                </button>
            </form>
            
            <div class="login-footer">
                <p>Non hai un account? <a href="{{ url_for('register') }}" class="login-link">Registrati</a></p>
            </div>
        </div>
    </div>
</div>

<script>
    // Gestione dei messaggi tramite URL parameters
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const messageContainer = document.getElementById('message-container');
        
        if (urlParams.has('message')) {
            const message = urlParams.get('message');
            
            if (message === 'account_deleted') {
                messageContainer.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                        <span class="block sm:inline">Il tuo account è stato eliminato con successo.</span>
                    </div>
                `;
            } else if (message === 'password_reset') {
                messageContainer.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                        <span class="block sm:inline">La tua password è stata reimpostata con successo. Effettua l'accesso con la nuova password.</span>
                    </div>
                `;
            } else if (message === 'logout_success') {
                messageContainer.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                        <span class="block sm:inline">Hai effettuato il logout con successo.</span>
                    </div>
                `;
            }
            
            // Rimuovi il parametro dall'URL senza ricaricare la pagina
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    });
</script>
{% endblock %}
